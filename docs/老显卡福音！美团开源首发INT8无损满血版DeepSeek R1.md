Title: è€æ˜¾å¡ç¦éŸ³ï¼ç¾å›¢å¼€æºé¦–å‘INT8æ— æŸæ»¡è¡€ç‰ˆDeepSeek R1

URL Source: https://mp.weixin.qq.com/s/Rsv0ELMbJpeCqgYsMy1PkA

Markdown Content:
##### ç¾å›¢æœæ¨å›¢é˜Ÿ æŠ•ç¨¿  
é‡å­ä½ | å…¬ä¼—å· QbitAI

æ»¡è¡€ç‰ˆDeepSeek R1éƒ¨ç½²**A100**ï¼ŒåŸºäºINT8é‡åŒ–ï¼Œç›¸æ¯”BF16å®ç°**50%ååæå‡**ï¼

ç¾å›¢æœæ¨æœºå™¨å­¦ä¹ å›¢é˜Ÿæœ€æ–°å¼€æºï¼Œå®ç°å¯¹DeepSeek R1æ¨¡å‹åŸºæœ¬æ— æŸçš„INT8ç²¾åº¦é‡åŒ–ã€‚

è¦çŸ¥é“ï¼ŒDeepSeek R1åŸç”Ÿç‰ˆæœ¬çš„æ¨¡å‹æƒé‡ä¸ºFP8æ•°æ®æ ¼å¼ï¼Œ**å¯¹GPUèŠ¯ç‰‡ç±»å‹æœ‰ä¸¥æ ¼é™åˆ¶**ï¼Œä»…èƒ½è¢«è‹±ä¼Ÿè¾¾æ–°å‹GPUæ”¯æŒï¼ˆå¦‚Adaã€Hopperæ¶æ„èŠ¯ç‰‡ï¼‰ï¼Œå…¶ä»–å‹å·GPUï¼ˆå¦‚A100ï¼‰æ— æ³•ç›´æ¥éƒ¨ç½²ã€‚

ç›®å‰ï¼Œ**é‡åŒ–ä»£ç å·²ç»åˆå…¥åˆ°äº†å¼€æºLLMæ¨ç†æ¡†æ¶SGLang**ï¼Œé‡åŒ–æ¨¡å‹å·²ç»å‘å¸ƒåˆ°äº†Hugging Faceç¤¾åŒºï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ã€‚

INT8: å‹å¥½çš„â€œå¹³æ›¿â€
-------------

æ ¹æ®DeepSeekæœ€æ–°å‘å¸ƒçš„æŠ€æœ¯æŠ¥å‘Šï¼ŒV3/R1çªç ´æ€§çš„è®­ç»ƒæˆæœ¬æ§åˆ¶ä¸»è¦ä¾æ‰˜FP8ç²¾åº¦è®­ç»ƒæ–¹æ¡ˆã€‚FP8æ˜¯ä¸€ç§å…¸å‹çš„æ¨¡å‹é‡åŒ–æŠ€æœ¯ï¼Œç›¸è¾ƒäºä¸šç•Œå¸¸ç”¨çš„BF16ç²¾åº¦ï¼ŒFP8ç²¾åº¦é€šè¿‡å°†æ•°æ®ä½å®½å‡åŠæ˜¾è‘—é™ä½äº†å•æ¬¡è®¡ç®—å¼€é”€ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„ç²¾åº¦æŸå¤±ã€‚

åœ¨å®è·µä¸­ï¼ŒDeepSeek R1é‡‡ç”¨äº†æ··åˆç²¾åº¦è®­ç»ƒæœºåˆ¶æœ‰æ•ˆç¼“è§£äº†ç²¾åº¦æŸå¤±é—®é¢˜ã€‚

ä¸ºäº†ç»§ç»­ä¿æŒé«˜ååæ€§èƒ½ï¼Œç¾å›¢æŠ€æœ¯å›¢é˜Ÿ**é€‰æ‹©äº†å’ŒFP8ç²¾åº¦ç­‰ä½å®½çš„INT8ç²¾åº¦ã€‚**åŒæ—¶ï¼ŒINT8ç²¾åº¦è¢«å¹¿æ³›ç¡¬ä»¶åŸç”Ÿæ”¯æŒï¼ŒåŸºäºINT8ç²¾åº¦å¯ä»¥æå¤§æ‹“å±•DeepSeekæ¨¡å‹çš„ç¡¬ä»¶éƒ¨ç½²èŒƒå›´ã€‚ä»¥ç¡¬ä»¶å‹å¥½çš„INT8ç²¾åº¦ä¸ºä¸­å¿ƒï¼Œç¾å›¢æŠ€æœ¯å›¢é˜Ÿå¼€å§‹æ¢ç´¢FP8â€œå¹³æ›¿â€çš„è½åœ°æ–¹æ¡ˆã€‚

![Image 1](https://mmbiz.qpic.cn/mmbiz_png/YicUhk5aAGtBaKYKk4UzwhFibLaZ5w7jIicW19hYW0NSS9mZwRBiaXibpQD3KANMrh5AVOUj6yHgZejnhWTQ7SkvvyA/640?wx_fmt=png&from=appmsg)

é‡åŒ–æŠ€æœ¯çš„æ¢ç´¢
-------

å…·ä½“æ¥è¯´ï¼Œ**åˆ†å—é‡åŒ–**ï¼ˆBlock-wise Quantizationï¼‰æ˜¯DeepSeek V3/R1é™ä½é‡åŒ–æŸå¤±çš„å…³é”®æŠ€æœ¯ä¹‹ä¸€ã€‚åˆ†å—é‡åŒ–é€šè¿‡å¯¹æƒé‡çŸ©é˜µçš„ç»†ç²’åº¦åˆ‡åˆ†ï¼Œå°†é‡åŒ–æ“ä½œçš„èŒƒå›´æ§åˆ¶åœ¨\[128, 128\]çš„çŸ©é˜µå†…ï¼Œå‡å°‘äº†åˆ†å¸ƒåˆ†æ•£çš„å‡ºç°æ¦‚ç‡ï¼Œä»è€Œå¾ˆå¥½åœ°æ§åˆ¶äº†æ¯æ¬¡é‡åŒ–è¿‡ç¨‹ä¸­çš„æŸå¤±ã€‚

ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå»¶ç»­äº†DeepSeekè®­ç»ƒçš„é‡åŒ–ç­–ç•¥ï¼ŒåŒæ ·åœ¨\[128, 128\]çš„çŸ©é˜µå†…è¿›è¡Œåˆ†å—é‡åŒ–æ“ä½œï¼Œä¿è¯è®­ç»ƒå’Œæ¨ç†çš„ä¸€è‡´æ€§ã€‚åœ¨é‡åŒ–ç›®æ ‡çš„é€‰å‹ä¸Šï¼ŒINT8çš„ä¼˜åŠ¿åœ¨äºå…¶ä¸FP8äº«æœ‰ç›¸åŒçš„ä½å®½ï¼Œä¸”å¤§éƒ¨åˆ†ç¡¬ä»¶éƒ½å¯¹INT8çš„æ•°æ®è®¡ç®—åŸç”Ÿæ”¯æŒã€‚

åœ¨å®è·µä¸­ï¼Œç”±äºDeepSeekå®˜æ–¹å¹¶æ²¡æœ‰æä¾›åŠç²¾åº¦æµ®ç‚¹å‹ï¼ˆBF16ï¼‰çš„æƒé‡ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å°†åŸç”Ÿçš„FP8æ¨¡å‹æƒé‡åé‡åŒ–æˆBF16ï¼Œå†åˆ†å—é‡åŒ–æˆINT8ç±»å‹ã€‚å¦å¤–åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†åŒ¹é…æƒé‡çš„åˆ†å—é‡åŒ–ï¼Œæ¿€æ´»å€¼é‡‡ç”¨åœ¨çº¿é€token-groupçš„é‡åŒ–æ–¹å¼ï¼Œå³æ¯ä¸ªtokençš„åµŒå…¥å‘é‡åˆ†ä¸ºå¤šä¸ªç»„ï¼Œé€ç»„è¿›è¡Œé‡åŒ–ã€‚åˆ†å—é‡åŒ–çš„æ¿€æ´»å€¼å’Œæƒé‡çš„ä¹˜æ³•è¿‡ç¨‹å¦‚ä¸‹å·¦å›¾æ‰€ç¤ºã€‚

é™¤äº†ä¸Šè¿°çš„åˆ†å—é‡åŒ–å¤–ï¼Œç¾å›¢æŠ€æœ¯å›¢é˜Ÿè¿˜æ¢ç´¢äº†**æ›´é«˜æ•ˆçš„é€šé“é‡åŒ–****ï¼ˆChannel-wise Quantizationï¼‰ï¼Œå³æƒ****é‡çš„æ¯åˆ—ä¸ºä¸€ç»„è¿›è¡Œé‡åŒ–ã€‚**

é€šé“é‡åŒ–åœ¨æ‰§è¡Œå®ŒINT8çš„çŸ©é˜µä¹˜æ³•åï¼Œåªéœ€è¿›è¡Œä¸€æ¬¡åé‡åŒ–è®¡ç®—ï¼Œè®¡ç®—å¼€é”€æ›´ä½ã€‚åœ¨å…·ä½“å®è·µä¸­ï¼ŒåŒæ ·åœ°å…ˆå°†åŸç”ŸFP8çš„æ¨¡å‹æƒé‡åé‡åŒ–æˆBF16ï¼Œä¹‹åé€é€šé“é‡åŒ–æˆINT8ç±»å‹ã€‚åŒæ—¶ï¼Œå¯¹æ¿€æ´»å€¼é‡‡ç”¨åœ¨çº¿é€tokené‡åŒ–ï¼Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘activationçš„é‡åŒ–æŸå¤±ã€‚é€šé“é‡åŒ–çš„æ¿€æ´»å€¼å’Œæƒé‡çš„ä¹˜æ³•è¿‡ç¨‹å¦‚ä¸‹å³å›¾æ‰€ç¤ºã€‚

**ç›®å‰ï¼Œä¸¤ç§INT8é‡åŒ–æƒé‡å‡å·²å¼€æºåˆ°Hugging Faceã€‚**

INT8é‡åŒ–æ¨¡å‹ç²¾åº¦
----------

åˆ†åˆ«åº”ç”¨ä¸Šè¿°çš„ä¸¤ç§é‡åŒ–æ–¹æ³•ï¼Œå¯¹å¼€æºçš„DeepSeek R1æ¨¡å‹è¿›è¡Œäº†INT8é‡åŒ–å¤„ç†ï¼Œå¹¶åœ¨GSM8Kå’ŒMMLUä¸¤ä¸ªæ•°æ®é›†ä¸Šå¯¹é‡åŒ–åçš„æ¨¡å‹è¿›è¡Œäº†ç²¾åº¦è¯„ä¼°ã€‚è¯„ä¼°ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œç›¸æ¯”åŸºçº¿çš„BF16å’ŒFP8æ¨¡å‹ï¼Œä¸¤ç§INT8é‡åŒ–æ¨¡å‹çš„ç²¾åº¦åŸºæœ¬æ— æŸã€‚

![Image 2](https://mmbiz.qpic.cn/mmbiz_png/YicUhk5aAGtBaKYKk4UzwhFibLaZ5w7jIicQtPrAYWueC4WUp59rhOu3WormFut3KnEHc9CQNzT8gYHAQnoNfsn4w/640?wx_fmt=png&from=appmsg)

æ³¨ï¼šè¡¨ä¸­çš„ç²¾åº¦ç»“æœæ˜¯å¤šæ¬¡æµ‹è¯•çš„å‡å€¼ã€‚

INT8é‡åŒ–æ¨¡å‹æ¨ç†åå
------------

åœ¨çŸ¥åå¼€æºæ¨ç†æ¡†æ¶SGLangä¸Šï¼Œå¯¹ä¸Šè¿°ä¸¤ç§INT8é‡åŒ–æ–¹æ³•è¿›è¡Œäº†æ¨ç†æ”¯æŒï¼Œå¹¶è¿›è¡Œäº†æ¨ç†ååè¯„ä¼°ã€‚SGLangæ˜¯å½“å‰SOTAçš„å¼€æºLLMæ¨ç†æ¡†æ¶ï¼Œåœ¨DeepSeekç³»åˆ—æ¨¡å‹ä¸Šæœ‰ç€æœ€ä¼˜çš„æ¨ç†æ€§èƒ½ï¼Œè¢«ä¸šç•Œå¹¿æ³›ä½¿ç”¨ã€‚

åœ¨A100 GPUä¸Šå¯¹ä¸¤ç§INT8æ¨¡å‹å’ŒBF16æ¨¡å‹è¿›è¡Œæ¨ç†ååè¯„ä¼°ã€‚å¾—ç›Šäºæ›´ä½çš„æ˜¾å­˜è¦æ±‚ï¼ŒINT8é‡åŒ–æ¨¡å‹ä»…éœ€è¦16å¼ A100 GPUå³å¯æ¨ç†ï¼Œä½†æ˜¯BF16æ¨¡å‹éœ€è¦32å¼ A100 GPUã€‚ä¸ºäº†æ¯”è¾ƒçš„å…¬å¹³æ€§ï¼Œç»Ÿä¸€åœ¨32å¼ A100 GPUä¸Šè¿›è¡Œååæµ‹è¯•ã€‚ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ**åˆ†å—é‡åŒ–çš„INT8æ¨ç†ç›¸æ¯”BF16å¯ä»¥æå‡33%çš„ååï¼›é€šé“é‡åŒ–çš„INT8æ¨ç†å¯ä»¥è¿›ä¸€æ­¥è¾¾åˆ°50%çš„ååæå‡ã€‚**

![Image 3](https://mmbiz.qpic.cn/mmbiz_png/YicUhk5aAGtBaKYKk4UzwhFibLaZ5w7jIic9IlsvuuMcZABZYoIAibcxdD9sH5XIU98icuEibpVEg8utuDtnSicAJPRgQ/640?wx_fmt=png&from=appmsg)

INT8é‡åŒ–æ¨¡å‹éƒ¨ç½²
----------

ä»¥åŒèŠ‚ç‚¹å„8å¼ A100 GPUä¸ºä¾‹ï¼Œå¼€å‘è€…éœ€è¦åœ¨åŒéƒ¨ç½²èŠ‚ç‚¹å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„SGLangï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š

```
# åˆ†å—é‡åŒ–INT8æ¨ç†
```

```
# é€šé“é‡åŒ–INT8æ¨ç†
```

ä¸‹é¢æ˜¯ä¸€äº›æœ‰è¶£çš„caseï¼š

### æ·±åº¦æ€è€ƒèƒ½åŠ›å±•ç¤º

è¿™é‡Œä»¥curlä¸ºä¾‹å‘é€ä¸€æ¡è¯·æ±‚ï¼š

```
curl -X POST 'http://HEAD_IP:5000/v1/chat/completions' \
```

åœ¨INT8 R1çš„å›ç­”ä¸­ï¼ˆç”±äºç¯‡å¹…é™åˆ¶çœç•¥éƒ¨åˆ†å†…å®¹ï¼‰ï¼Œèƒ½çœ‹åˆ°å…¶é£æ ¼ç‹¬ç‰¹çš„åæ€ï¼š

> ä¸è¿‡ï¼Œæˆ‘éœ€è¦ç¡®è®¤è¿™ä¸€ç‚¹æ˜¯å¦æ­£ç¡®ã€‚æ¯”å¦‚ï¼Œæœ‰æ²¡æœ‰å¯èƒ½å…¶ä»–é€‰é¡¹ä¸­ä¹Ÿæœ‰åˆé‡‘ï¼Ÿæ¯”å¦‚ï¼Œé”¡æœ‰æ—¶å€™ä¼šå’Œå…¶ä»–é‡‘å±æ··åˆä½¿ç”¨ï¼Œä½†é”¡æœ¬èº«æ˜¯çº¯é‡‘å±ã€‚åŒæ ·ï¼Œé“ã€é“ã€é“œéƒ½æ˜¯çº¯é‡‘å±ã€‚æ‰€ä»¥é’¢ä½œä¸ºåˆé‡‘ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå…³é”®çš„ä¸åŒç‚¹ã€‚å¦å¤–ï¼Œå¯ä»¥è€ƒè™‘å…¶ä»–å±æ€§ï¼Œæ¯”å¦‚å®ƒä»¬çš„ç”¨é€”ã€ç‰©ç†æ€§è´¨æˆ–åŒ–å­¦æ€§è´¨ã€‚ä¾‹å¦‚ï¼Œå¯¼ç”µæ€§ï¼šé“¶æ˜¯æœ€å¥½çš„å¯¼ä½“ï¼Œä½†è¿™é‡Œæ²¡æœ‰é“¶ï¼Œè€Œé“œçš„å¯¼ç”µæ€§ä¹Ÿå¾ˆå¥½ï¼Œé“ä¹Ÿä¸é”™ï¼Œé“å’Œé’¢çš„å¯¼ç”µæ€§ç›¸å¯¹å·®ä¸€äº›ã€‚ä½†è¿™æ ·åˆ†ç±»çš„è¯ï¼Œå¯èƒ½éš¾ä»¥ç¡®å®šå“ªä¸€ä¸ªä¸åŒã€‚â€¦â€¦ä¸è¿‡å›åˆ°æœ€åˆçš„åˆ†ç±»ï¼Œé’¢æ˜¯å”¯ä¸€çš„åˆé‡‘ï¼Œè€Œå…¶ä»–éƒ½æ˜¯çº¯é‡‘å±ï¼Œè¿™ä¸€ç‚¹å¯èƒ½æ›´ä¸ºåŸºç¡€ã€‚å› æ­¤ç­”æ¡ˆåº”è¯¥æ˜¯3.é’¢ã€‚ä¸è¿‡éœ€è¦å†éªŒè¯ä¸€ä¸‹è¿™ä¸ªç»“è®ºæ˜¯å¦æ­£ç¡®ã€‚

**æœ€ç»ˆç­”æ¡ˆä¹Ÿæ˜¯æ­£ç¡®çš„ï¼š**

ç­”æ¡ˆï¼š3.é’¢

### æ¨¡æ‹Ÿæµ·é‡å°çƒè¿åŠ¨

å‚è€ƒå…¶ä»–LLMæµ‹è¯•çš„promptsä½œä¸ºè¾“å…¥ï¼Œå¯¹æ¯”INT8ï¼ˆä¸Šï¼‰å’ŒFP8ï¼ˆä¸‹ï¼‰è¾“å‡ºä»£ç çš„è¿è¡Œæ•ˆæœï¼ŒINT8å®Œå…¨ä¸é€ŠäºFP8ã€‚

> write a script for 100 bouncing balls within a sphere, make sure to handle collision detection properly. make the sphere slowly rotate. make sure balls stays within the sphere. implement it in p5.js

![Image 4](https://mmbiz.qpic.cn/mmbiz_gif/YicUhk5aAGtBaKYKk4UzwhFibLaZ5w7jIicZiaCWHBY310IzO7GgkP02DaLCiaicWgpAn6JaibglsicNThnpb717nVZE4g/640?wx_fmt=gif&from=appmsg)

![Image 5](https://mmbiz.qpic.cn/mmbiz_gif/YicUhk5aAGtBaKYKk4UzwhFibLaZ5w7jIicIWuVW6rNLiaib5arTRqia6nWGib5g8VkOngSpWzR5C5lsFfWjGic3Q37R1g/640?wx_fmt=gif&from=appmsg)

æ€»ç»“ä¸å±•æœ›
-----

ç»¼ä¸Šï¼Œç ”ç©¶å›¢é˜Ÿåœ¨DeepSeek R1ä¸Šè¿›è¡Œäº†INT8é‡åŒ–æŠ€æœ¯çš„æ¢ç´¢ï¼Œå¹¶åŸºäºSGLangæ¡†æ¶è¿›è¡Œäº†æ¨ç†èƒ½åŠ›çš„æ”¯æŒï¼Œåœ¨ä¿è¯é‡åŒ–åæ¨¡å‹ç²¾åº¦çš„å‰æä¸‹ï¼Œè®©DeepSeek R1å¯ä»¥åœ¨å¦‚A100ç­‰è€å‹å·GPUä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œå¹¶ä¸”æå‡äº†æ¨ç†ååã€‚æˆ‘ä»¬å¸Œæœ›å¼€æºçš„ä»£ç å’Œæƒé‡å¯ä»¥è®©æ›´å¤šç”¨æˆ·å’Œä¸šåŠ¡æ–¹å—ç›Šï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ç§¯æäº¤æµç›¸å…³æŠ€æœ¯ï¼Œå…±åŒå»ºè®¾ã€å›é¦ˆå¼€æºç¤¾åŒºã€‚

ğŸ“®äº¤æµé‚®ç®±ï¼šsearch.platform@meituan.com

å‚è€ƒæ–‡çŒ®  
\[1\] æŠ€æœ¯æŠ¥å‘Šï¼šLiu A, Feng B, Xue B, et al. Deepseek-v3 technical report\[J\]. arXiv preprint arXiv:2412.19437, 2024.  
\[2\] Hugging Faceï¼šhttps://huggingface.co/meituan/DeepSeek-R1-Block-INT8ï¼Œhttps://huggingface.co/meituan/DeepSeek-R1-Channel-INT8  
\[3\] æ¨ç†æ”¯æŒï¼šBlock-wise INT8 DeepSeek R1æ”¯æŒï¼ˆhttps://github.com/sgl-project/sglang/pull/3730ï¼‰ã€Channel-wise INT8 DeepSeek R1æ”¯æŒï¼ˆhttps://github.com/sgl-project/sglang/pull/3888ï¼‰  
\[4\] å…¶ä»–LLMæµ‹è¯•ï¼šhttps://qwenlm.github.io/blog/qwq-max-preview/

â€”Â **å®Œ**Â â€”

**å­¦æœ¯**æŠ•ç¨¿è¯·äº**å·¥ä½œæ—¥**å‘é‚®ä»¶åˆ°ï¼š

**ai@qbitai.com**

æ ‡é¢˜æ³¨æ˜ã€æŠ•ç¨¿ã€‘ï¼Œå‘Šè¯‰æˆ‘ä»¬ï¼š

ä½ æ˜¯è°ï¼Œä»å“ªæ¥ï¼ŒæŠ•ç¨¿å†…å®¹

é™„ä¸Šè®ºæ–‡/é¡¹ç›®ä¸»é¡µé“¾æ¥ï¼Œä»¥åŠè”ç³»æ–¹å¼å“¦

æˆ‘ä»¬ä¼šï¼ˆå°½é‡ï¼‰åŠæ—¶å›å¤ä½ 

![Image 6](https://mmbiz.qpic.cn/mmbiz_gif/YicUhk5aAGtC5nGy7YMGhQ0ZJeyibWyL0KVCtiaLEPMyd4Bszuo0bFIOxZOvdmqdxnOosYXyu5aI7MXpyUrUWfz6g/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)

**ä¸€é”®å…³æ³¨ ğŸ‘‡ ç‚¹äº®æ˜Ÿæ ‡**

**ç§‘æŠ€å‰æ²¿è¿›å±•æ¯æ—¥è§**

**ä¸€é”®ä¸‰è¿****ã€Œç‚¹èµã€ã€Œè½¬å‘ã€ã€Œå°å¿ƒå¿ƒã€**

**æ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æƒ³æ³•ï¼**
